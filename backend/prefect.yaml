# Prefect deployment configuration
name: threat-intel-backend
prefect-version: 3.6.17

# Use local filesystem (code is mounted into the container at /app)
pull:
  - prefect.deployments.steps.set_working_directory:
      directory: /app

build: null
push: null

deployments:

  - name: rss-url-collector
    tags:
      - rss
      - threat-intel
      - url-collection
    description: "Collect RSS article URLs published in the last 24 hours"
    entrypoint: workflows/new_flows/parse_rss.py:run
    work_pool:
      name: default-worker
    # schedules:
    #   - cron: "0 * * * *"
    #     timezone: "UTC"
    #     active: true
    parameters:
      window_hours: 24
      max_items_per_feed: 100
      limit_sources: 0
      dry_run: false
    enforce_parameter_schema: false

  - name: get-link-content
    tags:
      - scraping
      - threat-intel
      - content
    description: "Scrape article body text for all new RSS items"
    entrypoint: workflows/new_flows/get_link_content.py:run
    work_pool:
      name: default-worker
    enforce_parameter_schema: false

  - name: classify-articles
    tags:
      - classification
      - threat-intel
      - llm
    description: "Classify articles as cyber attack campaigns, CVEs, or digest using LLM"
    entrypoint: workflows/new_flows/relevant_article_classification.py:run
    work_pool:
      name: default-worker
    enforce_parameter_schema: false

  - name: cluster-articles
    tags:
      - clustering
      - threat-intel
      - llm
    description: "Summarize and cluster active campaign articles into cyber attack campaigns"
    entrypoint: workflows/new_flows/article_clustering.py:run
    work_pool:
      name: default-worker
    parameters:
      prompt_version: 1
    enforce_parameter_schema: false
